<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UDM GPS æ‰“å¡</title>
<style>
body{font-family:system-ui;background:#f4f6f8;padding:20px}
.box{max-width:420px;margin:auto;background:#fff;padding:20px;border-radius:12px}
input,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{border:none;border-radius:8px;background:#2f6fd6;color:#fff}
.out{background:#555}
.info{margin-top:12px;font-size:14px}
.ok{color:green}
.err{color:red}
</style>
</head>
<body>

<div class="box">
<h2>UDM GPS æ‰“å¡</h2>

<input id="name" placeholder="è«‹è¼¸å…¥å§“å">

<button onclick="punch('IN')">ä¸Šç­æ‰“å¡</button>
<button class="out" onclick="punch('OUT')">ä¸‹ç­æ‰“å¡</button>

<div class="info">
ğŸ“ ç·¯åº¦ï¼š<span id="lat">-</span><br>
ğŸ“ ç¶“åº¦ï¼š<span id="lon">-</span><br>
ğŸ¯ ç²¾æº–åº¦ï¼š<span id="acc">-</span> m<br>
<div id="msg">ç­‰å¾…å®šä½â€¦</div>
</div>
</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzFWXo1fsxLv2ghk_8l0vZuS8nex9h_3y-LX69R0fOLO6o8ZO6rMjMAif5UqfgN1I0L/exec";

let gps=null;

navigator.geolocation.getCurrentPosition(p=>{
  gps=p.coords;
  lat.innerText=gps.latitude;
  lon.innerText=gps.longitude;
  acc.innerText=gps.accuracy;
  msg.innerText="GPS å°±ç·’";
  msg.className="ok";
},{enableHighAccuracy:true});

function punch(action){
  const name=document.getElementById("name").value.trim();
  if(!name||!gps){alert("å§“åæˆ– GPS å°šæœªå®Œæˆ");return;}

  const q=new URLSearchParams({
    type:"attendance",
    name:name,
    action:action,
    lat:gps.latitude,
    lon:gps.longitude,
    accuracy:gps.accuracy,
    device:"github"
  });

  fetch(API_URL+"?"+q.toString())
    .then(r=>r.json())
    .then(()=>{msg.innerText="âœ… æ‰“å¡æˆåŠŸ";msg.className="ok";})
    .catch(()=>{msg.innerText="âŒ å¤±æ•—";msg.className="err";});
}
</script>

</body>
</html>
