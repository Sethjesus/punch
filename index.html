<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>äººäº‹æ‰“å¡</title>
<style>
body{background:#555;font-family:system-ui}
.card{background:#f2f2f2;width:320px;margin:20px auto;padding:16px;border-radius:8px}
input,button{width:100%;padding:8px;margin:6px 0}
.log{background:#000;color:#0f0;height:150px;overflow:auto;font-size:12px;padding:6px}
</style>
</head>
<body>

<div class="card">
  <h3>å“¡å·¥æ‰“å¡</h3>
  <input id="name" placeholder="è«‹è¼¸å…¥å§“å" />
  <button onclick="punch('ä¸Šç­')">ä¸Šç­</button>
  <button onclick="punch('ä¸‹ç­')">ä¸‹ç­</button>
  <div id="log" class="log"></div>
</div>

<script>
const API = "https://punch-api.jackey1688.workers.dev/api/punch";
const company = { lat:25.00657, lng:121.48416 };
const logBox = document.getElementById("log");
const nameInput = document.getElementById("name");

function log(t){ logBox.innerHTML+=t+"<br>"; logBox.scrollTop=logBox.scrollHeight; }
function dist(a,b,c,d){
  const R=6371000,toRad=x=>x*Math.PI/180;
  const dLat=toRad(c-a), dLng=toRad(d-b);
  const s=Math.sin(dLat/2)**2+
    Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLng/2)**2;
  return Math.round(2*R*Math.asin(Math.sqrt(s)));
}

function punch(action){
  if(!nameInput.value.trim()){ alert("è«‹è¼¸å…¥å§“å"); return; }
  log("ğŸ“¡ å–å¾— GPSâ€¦");
  navigator.geolocation.getCurrentPosition(async p=>{
    const lat=p.coords.latitude, lng=p.coords.longitude;
    const d=dist(lat,lng,company.lat,company.lng);
    log(`ğŸ‘¤ ${nameInput.value}`);
    log(`ğŸ“ ${lat}, ${lng}`);
    log(`ğŸ¢ è·å…¬å¸ ${d} å…¬å°º`);
    await fetch(API,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ name:nameInput.value.trim(), action, lat, lng })
    });
    log("âœ… æ‰“å¡æˆåŠŸ");
  },e=>log("âŒ GPS å¤±æ•—ï¼š"+e.message),{enableHighAccuracy:true});
}
</script>
</body>
</html>
