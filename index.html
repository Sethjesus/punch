<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å…¬å¸æ‰“å¡ç³»çµ±</title>

<style>
body{
  font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
  background:#f3f4f6;
}
.card{
  max-width:420px;
  margin:40px auto;
  background:#fff;
  padding:24px;
  border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
h2{
  text-align:center;
  margin-bottom:18px;
}
input{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-bottom:14px;
}
button{
  width:100%;
  padding:14px;
  font-size:18px;
  border:none;
  border-radius:14px;
  color:#fff;
  font-weight:700;
  margin-bottom:12px;
  cursor:pointer;
}
.in{ background:#2563eb; }
.out{ background:#16a34a; }
.leave{ background:#6b7280; }

.msg{
  text-align:center;
  font-size:16px;
  font-weight:700;
  margin-top:10px;
}
.sub{
  text-align:center;
  font-size:13px;
  color:#555;
  margin-top:4px;
}
.footer{
  text-align:center;
  font-size:12px;
  color:#888;
  margin-top:16px;
}
</style>
</head>

<body>

<div class="card">
  <h2>ğŸ“ å…¬å¸æ‰“å¡</h2>

  <input id="name" placeholder="è«‹è¼¸å…¥å§“å">
  <input id="pin" placeholder="è«‹è¼¸å…¥é€²å…¥ PIN" type="password">

  <button class="in" onclick="punch('ä¸Šç­')">ğŸ•˜ ä¸Šç­</button>
  <button class="out" onclick="punch('ä¸‹ç­')">ğŸ•• ä¸‹ç­</button>
  <button class="leave" onclick="punch('è«‹å‡')">ğŸ– è«‹å‡</button>

  <div class="msg" id="msg">è«‹è¼¸å…¥å§“åèˆ‡ PIN</div>
  <div class="sub" id="sub"></div>

  <div class="footer">
    ç³»çµ±ç”± HR ç®¡ç†é€²å…¥æ¬Šé™
  </div>
</div>

<script>
const API = "https://ä½ çš„-worker.workers.dev";

function punch(action){
  const name = document.getElementById("name").value.trim();
  const pin  = document.getElementById("pin").value.trim();
  const msg  = document.getElementById("msg");
  const sub  = document.getElementById("sub");

  if(!name || !pin){
    msg.innerText = "â— è«‹è¼¸å…¥å§“åèˆ‡ PIN";
    sub.innerText = "";
    return;
  }

  msg.innerText = "ğŸ“ å–å¾—å®šä½ä¸­â€¦";
  sub.innerText = "è«‹å…è¨±å®šä½ï¼ˆç²¾ç¢ºä½ç½®ï¼‰";

  navigator.geolocation.getCurrentPosition(
    pos=>{
      fetch(API + "/api/punch",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          name,
          pin,
          action,
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        })
      })
      .then(r=>r.json())
      .then(d=>{
        if(d.ok){
          msg.innerText = "âœ… æ‰“å¡æˆåŠŸ";
          sub.innerText = `${action} å®Œæˆ`;
        }else{
          msg.innerText = "âŒ æ‰“å¡å¤±æ•—";
          sub.innerText = d.error || "è«‹è¯çµ¡äººäº‹";
        }
      })
      .catch(()=>{
        msg.innerText = "âŒ ç³»çµ±éŒ¯èª¤";
        sub.innerText = "è«‹ç¨å¾Œå†è©¦";
      });
    },
    err=>{
      msg.innerText = "âŒ ç„¡æ³•å–å¾—å®šä½";
      sub.innerText = err.message;
    },
    { enableHighAccuracy:true, timeout:15000 }
  );
}
</script>

</body>
</html>
