<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>員工打卡</title>
<style>
body { font-family: Arial; background:#f5f5f5; }
.card {
  max-width:420px; margin:40px auto; background:#fff;
  padding:20px; border-radius:12px;
}
input, select, button {
  width:100%; padding:10px; margin-top:10px;
}
button {
  background:#4f7df3; color:#fff; border:none; border-radius:6px;
}
#gps { margin-top:10px; font-size:14px; }
#debug {
  margin-top:12px; font-size:12px;
  background:#eee; padding:8px; border-radius:6px;
  white-space:pre-wrap;
}
</style>
</head>
<body>

<div class="card">
  <h2>員工打卡</h2>

  <input id="name" placeholder="姓名">
  <select id="action">
    <option value="上班">上班</option>
    <option value="下班">下班</option>
  </select>

  <div id="gps">GPS：尚未取得</div>
  <button onclick="punch()">打卡</button>

  <div id="debug"></div>
</div>

<script>
const debugBox = document.getElementById("debug");
const gpsBox = document.getElementById("gps");

function debug(msg, obj) {
  const t = `[${new Date().toLocaleTimeString()}] ${msg}`;
  debugBox.textContent += t + "\n";
  if (obj) debugBox.textContent += JSON.stringify(obj, null, 2) + "\n\n";
  console.log(t, obj || "");
}

async function punch() {
  debug("開始打卡");

  if (!navigator.geolocation) {
    debug("❌ 瀏覽器不支援 GPS");
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos => {
    const payload = {
      name: document.getElementById("name").value,
      action: document.getElementById("action").value,
      lat: pos.coords.latitude,
      lng: pos.coords.longitude
    };

    gpsBox.textContent = `GPS OK：${payload.lat}, ${payload.lng}`;
    debug("GPS 取得成功", payload);

    try {
      const res = await fetch(
        "https://punch-api.jackey1688.workers.dev/api/punch",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        }
      );

      debug("HTTP Status", { status: res.status });

      const data = await res.json();
      debug("API 回傳", data);

      if (data.ok) {
        debug("✅ 打卡成功");
      } else {
        debug("❌ 打卡失敗", data);
      }
    } catch (e) {
      debug("❌ fetch 例外", { error: e.message });
    }
  }, err => {
    debug("❌ GPS 失敗", err);
  });
}
</script>

</body>
</html>
