<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>UDM GPS å‡ºå‹¤</title>
<style>
body { font-family: system-ui; background:#f4f6f8; }
.card { width:360px; margin:60px auto; background:#fff; padding:20px; border-radius:10px; }
button { width:100%; padding:12px; margin:6px 0; font-size:16px; }
#status { margin-top:10px; }
</style>
</head>

<body>
<div class="card">
  <h2>UDM GPS å‡ºå‹¤</h2>

  <input id="name" placeholder="å§“å" style="width:100%;padding:10px">

  <button onclick="punch('IN')">ä¸Šç­æ‰“å¡</button>
  <button onclick="punch('OUT')">ä¸‹ç­æ‰“å¡</button>

  <div id="gps"></div>
  <div id="status"></div>
</div>

<script>
const API_URL =
'https://script.google.com/macros/s/AKfycbFWX01fsxLv2ghk_8I0vZuS8nex9h_3y-LX69R0fOLo6o8Z0rMJAIiF5UgfqN1L/exec';

const nameInput = document.getElementById('name');
nameInput.value = localStorage.getItem('udm_name') || '';
nameInput.oninput = () => localStorage.setItem('udm_name', nameInput.value);

function punch(action) {
  if (!nameInput.value) {
    alert('è«‹è¼¸å…¥å§“å');
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    const c = pos.coords;

    document.getElementById('gps').innerHTML =
      `ğŸ“ ç·¯åº¦ï¼š${c.latitude}<br>ğŸ“ ç¶“åº¦ï¼š${c.longitude}<br>ğŸ¯ ç²¾æº–åº¦ï¼š${c.accuracy} m`;

    const params = new URLSearchParams({
      type: 'attendance',
      name: nameInput.value,
      action,
      lat: c.latitude,
      lon: c.longitude,
      accuracy: c.accuracy,
      device: navigator.userAgent
    });

    fetch(API_URL + '?' + params)
      .then(r => r.json())
      .then(r => {
        document.getElementById('status').innerHTML =
          r.ok ? 'âœ… é€å‡ºæˆåŠŸ' : 'âŒ é€å‡ºå¤±æ•—ï¼š' + r.msg;
      })
      .catch(err => {
        document.getElementById('status').innerHTML = 'âŒ é€£ç·šéŒ¯èª¤';
      });

  }, err => alert('GPS å¤±æ•—ï¼š' + err.message), {
    enableHighAccuracy: true,
    timeout: 10000
  });
}
</script>
</body>
</html>
