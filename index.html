<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ‰“å¡ / è«‹å‡ç³»çµ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: system-ui, sans-serif;
  max-width: 420px;
  margin: auto;
  padding: 20px;
}
h2 { margin-top: 24px; }
button {
  width: 100%;
  padding: 14px;
  margin: 8px 0;
  font-size: 16px;
}
input, textarea {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  font-size: 14px;
}
textarea { min-height: 60px; }
pre {
  background: #f4f4f4;
  padding: 10px;
  white-space: pre-wrap;
}
hr { margin: 24px 0; }
</style>
</head>
<body>

<h2>ğŸ“ GPS æ‰“å¡</h2>
<button onclick="punch('in')">ğŸŸ¢ ä¸Šç­æ‰“å¡</button>
<button onclick="punch('out')">ğŸ”´ ä¸‹ç­æ‰“å¡</button>

<hr>

<h2>ğŸ“ è«‹å‡ç”³è«‹</h2>

<label>è«‹å‡æ—¥æœŸ</label>
<input id="leaveDate" type="date">

<label>é–‹å§‹æ™‚é–“</label>
<input id="leaveFrom" type="time">

<label>çµæŸæ™‚é–“</label>
<input id="leaveTo" type="time">

<textarea id="leaveReason" placeholder="è«‹å‡åŸå› "></textarea>

<button onclick="leave()">ğŸ“¤ é€å‡ºè«‹å‡</button>

<hr>

<pre id="result">ç­‰å¾…æ“ä½œ...</pre>

<script>
const API_BASE = "https://punch-api.jackey1688.workers.dev";
const userId = "jackey"; // ä¹‹å¾Œå¯æ”¹ç™»å…¥/åƒæ•¸

/* ===== æ‰“å¡ ===== */
function punch(type) {
  const result = document.getElementById("result");
  result.textContent = "å–å¾— GPS ä¸­...";

  if (!navigator.geolocation) {
    result.textContent = "æ­¤è£ç½®ä¸æ”¯æ´ GPS";
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos => {
    const payload = {
      userId,
      type,
      lat: pos.coords.latitude,
      lng: pos.coords.longitude
    };

    try {
      const res = await fetch(`${API_BASE}/api/punch`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      result.textContent = JSON.stringify(data, null, 2);
    } catch (e) {
      result.textContent = "æ‰“å¡å¤±æ•—ï¼š" + e.message;
    }
  }, err => {
    result.textContent = "GPS å¤±æ•—ï¼š" + err.message;
  });
}

/* ===== è«‹å‡ ===== */
async function leave() {
  const date = document.getElementById("leaveDate").value;
  const from = document.getElementById("leaveFrom").value;
  const to = document.getElementById("leaveTo").value;
  const reason = document.getElementById("leaveReason").value;
  const result = document.getElementById("result");

  if (!date || !from || !to || !reason) {
    result.textContent = "è«‹å¡«å¯«å®Œæ•´è«‹å‡è³‡è¨Šï¼ˆæ—¥æœŸï¼‹æ™‚é–“ï¼‹åŸå› ï¼‰";
    return;
  }

  const payload = { userId, date, from, to, reason };

  try {
    const res = await fetch(`${API_BASE}/api/leave`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    result.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    result.textContent = "è«‹å‡é€å‡ºå¤±æ•—ï¼š" + e.message;
  }
}
</script>

</body>
</html>
