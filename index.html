<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…¬å¸ GPS æ‰“å¡</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #f4f6f8;
    padding: 20px;
  }
  .card {
    max-width: 420px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,.08);
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  input, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 16px;
  }
  button {
    border: none;
    border-radius: 8px;
    background: #2563eb;
    color: #fff;
    font-weight: bold;
  }
  button.out {
    background: #16a34a;
  }
  .msg {
    margin-top: 12px;
    text-align: center;
    font-weight: bold;
  }
</style>
</head>

<body>
<div class="card">
  <h2>ğŸ“ å…¬å¸ GPS æ‰“å¡</h2>

  <input id="empId" placeholder="å·¥è™Ÿï¼ˆä¾‹å¦‚ U001ï¼‰">
  <input id="action" placeholder="ä¸Šç­ æˆ– ä¸‹ç­" readonly>

  <button onclick="punch('ä¸Šç­')">ğŸ•˜ ä¸Šç­</button>
  <button class="out" onclick="punch('ä¸‹ç­')">ğŸ•• ä¸‹ç­</button>

  <div class="msg" id="msg"></div>
</div>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbyGMYNPD7X5ngEKJnQ8vUe1T7-zpo9vWsAboYkod568iKbCSFD-IiHAR-d6VJW5rNxx/exec";

function punch(type) {
  document.getElementById("action").value = type;
  document.getElementById("msg").innerText = "å–å¾— GPS ä¸­â€¦";

  if (!navigator.geolocation) {
    alert("ç€è¦½å™¨ä¸æ”¯æ´ GPS");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    sendData(type, pos.coords.latitude, pos.coords.longitude);
  }, err => {
    alert("è«‹å…è¨± GPS å®šä½");
  }, {
    enableHighAccuracy: true,
    timeout: 10000
  });
}

function sendData(action, lat, lng) {
  const empId = document.getElementById("empId").value.trim();

  if (!empId) {
    alert("è«‹è¼¸å…¥å·¥è™Ÿ");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      empId: empId,
      action: action,
      lat: lat,
      lng: lng,
      device: navigator.userAgent
    })
  })
  .then(r => r.json())
  .then(d => {
    document.getElementById("msg").innerText =
      `çµæœï¼š${d.status}ï¼ˆ${d.distance_m ?? ""}mï¼‰`;
  })
  .catch(err => {
    document.getElementById("msg").innerText = "é€å‡ºå¤±æ•—";
  });
}
</script>
</body>
</html>
