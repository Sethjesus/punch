<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è«‹å‡ / åŠ ç­ / å‡ºå·®ç”³è«‹</title>

<style>
body{
  background:#3f3f3f;
  font-family:system-ui;
}
.card{
  width:360px;
  margin:40px auto;
  background:#f4f4f4;
  padding:16px;
  border-radius:10px;
}
input,select,button,textarea,label{
  width:100%;
  padding:8px;
  margin:6px 0;
  box-sizing:border-box;
}
.inline{
  display:flex;
  gap:6px;
}
button{ cursor:pointer; }
.log{
  background:#000;
  color:#0f0;
  font-size:12px;
  height:120px;
  overflow:auto;
  padding:6px;
}
hr{ margin:10px 0; }
.badge{
  display:inline-block;
  padding:2px 6px;
  border-radius:4px;
  font-size:12px;
  margin-bottom:6px;
}
.badge.ot{ background:#dff0ff; }
.badge.trip{ background:#e8ffe8; }
</style>
</head>

<body>

<div class="card">
  <h3>è«‹å‡ / åŠ ç­ / å‡ºå·®ç”³è«‹</h3>

  <input id="name" placeholder="å§“å">

  <select id="type">
    <option value="">è«‹é¸æ“‡é¡å‹</option>
    <option>å©šå‡</option>
    <option>å–ªå‡</option>
    <option>è‚²å…’å‡</option>
    <option>ç”Ÿç”¢å‡</option>
    <option>ç—…å‡</option>
    <option>ç‰¹ä¼‘</option>
    <option>åŠ ç­</option>
    <option>å‡ºå·®</option>
  </select>

  <label>é–‹å§‹æ—¥æœŸ</label>
  <input type="date" id="startDate">

  <label>é–‹å§‹æ™‚é–“</label>
  <input type="time" id="startTime" value="09:00">

  <label>çµæŸæ—¥æœŸ</label>
  <input type="date" id="endDate">

  <label>çµæŸæ™‚é–“</label>
  <input type="time" id="endTime" value="18:00">

  <div id="tripBlock" style="display:none">
    <hr>
    <span class="badge trip">å‡ºå·®è³‡è¨Š</span>
    <input id="tripPlace" placeholder="å‡ºå·®åœ°é»ï¼ˆä¾‹ï¼šå°ä¸­ / é«˜é›„ / æ—¥æœ¬æ±äº¬ï¼‰">
    <label>
      <input type="checkbox" id="crossCity">
      è·¨ç¸£å¸‚ / åœ‹å¤–
    </label>
  </div>

  <div id="otBlock" style="display:none">
    <hr>
    <span class="badge ot">åŠ ç­è³‡è¨Š</span>
    <label>
      <input type="checkbox" id="isHoliday">
      å‡æ—¥åŠ ç­
    </label>
  </div>

  <textarea id="reason" placeholder="è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰"></textarea>

  <button onclick="submitForm()">é€å‡ºç”³è«‹</button>

  <div id="log" class="log"></div>
</div>

<script>
const API = "https://punch-api.jackey1688.workers.dev/api/leave";
const logBox = document.getElementById("log");
const typeSel = document.getElementById("type");
const tripBlock = document.getElementById("tripBlock");
const otBlock = document.getElementById("otBlock");

typeSel.onchange = ()=>{
  tripBlock.style.display = typeSel.value === "å‡ºå·®" ? "block" : "none";
  otBlock.style.display   = typeSel.value === "åŠ ç­" ? "block" : "none";
};

function log(msg){
  logBox.innerHTML += msg + "<br>";
  logBox.scrollTop = logBox.scrollHeight;
}

async function submitForm(){

  const name = document.getElementById("name").value.trim();
  const type = typeSel.value;
  const sd   = document.getElementById("startDate").value;
  const st   = document.getElementById("startTime").value;
  const ed   = document.getElementById("endDate").value;
  const et   = document.getElementById("endTime").value;
  const baseReason = document.getElementById("reason").value.trim();

  if(!name || !type || !sd || !st || !ed || !et){
    alert("è«‹å¡«å¯«å®Œæ•´æ—¥æœŸèˆ‡æ™‚é–“");
    return;
  }

  let detail = `ã€${type}ã€‘\né–‹å§‹ï¼š${sd} ${st}\nçµæŸï¼š${ed} ${et}`;

  if(type === "å‡ºå·®"){
    const place = document.getElementById("tripPlace").value.trim();
    const cross = document.getElementById("crossCity").checked;
    detail += `\nåœ°é»ï¼š${place || "æœªå¡«"}\n${cross ? "è·¨ç¸£å¸‚ / åœ‹å¤–" : "åŒç¸£å¸‚"}`;
  }

  if(type === "åŠ ç­"){
    const holiday = document.getElementById("isHoliday").checked;
    detail += `\n${holiday ? "å‡æ—¥åŠ ç­" : "å¹³æ—¥åŠ ç­"}`;
  }

  if(baseReason){
    detail += `\nèªªæ˜ï¼š${baseReason}`;
  }

  log("ğŸ“¤ é€å‡ºç”³è«‹ä¸­â€¦");

  await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      name,
      type,
      start_date: sd,
      end_date: ed,
      reason: detail
    })
  });

  log("âœ… ç”³è«‹å·²é€å‡ºï¼ˆå«æ™‚é–“ / å‡ºå·® / åŠ ç­è³‡è¨Šï¼‰");
}
</script>

</body>
</html>
